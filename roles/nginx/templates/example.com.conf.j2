server {
        listen       {{ nginx_port }};
        server_name  {{ item.1 }};

        access_log  "{{ httpd_documents_directory }}/{{ item.1 }}/logs/nginx-access.log;
        error_log   "{{ httpd_documents_directory }}/{{ item.1 }}/logs/nginx-error.log;
        root        {{ httpd_documents_directory }}/{{ item.1 }}/htdocs
        index       index.php index.html;

        location / {
            try_files $uri $uri/ index.php /index.php$is_args$args;
        }

        location ~ \.php$ {
            proxy_set_header X-Real-IP  $remote_addr;
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_set_header Host $host;
            proxy_pass http://127.0.0.1:{{ varnish_port }};
        }

        location ~ /\.ht {
            deny  all;
        }
}